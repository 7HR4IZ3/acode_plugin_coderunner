(()=>{var e={958:function(e){e.exports=function(){"use strict";var e={d:function(t,n){for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t={};function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function a(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"string"==typeof t&&(t={innerHTML:t}),function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(Array.isArray(n)&&(i=n,n={}),"function"==typeof e)return e(n,i);if(e instanceof Node)t=e;else{if("string"!=typeof e)throw new Error("Invalid tag, ",r(e));t=document.createElement(e)}var a=n.ref;return delete n.ref,Object.keys(n).forEach((function(e){var r=n[e];if(void 0!==r)switch(e){case"child":o(t,[r]);break;case"children":if(!Array.isArray(r))throw new Error("children must be an array of Nodes");o(t,r.flat());break;case"attr":Object.keys(r).forEach((function(e){var n=r[e];void 0!==n&&t.setAttribute(e,n)}));break;case"style":case"dataset":Object.keys(r).forEach((function(n){var i=r[n];void 0!==i&&(t[e][n]=i)}));break;case"on":Object.keys(r).forEach((function(e){var n=r[e];void 0!==n&&n.forEach((function(n){t.addEventListener(e,n)}))}));break;default:t[e]=r}})),a&&a.instanceOfRef&&(a.el=t),t}(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:[])}function o(e,t){var n,r=function(e){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=function(e,t){if(e){if("string"==typeof e)return i(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}(e))){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,c=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return o=e.done,e},e:function(e){c=!0,a=e},f:function(){try{o||null==t.return||t.return()}finally{if(c)throw a}}}}(t);try{for(r.s();!(n=r.n()).done;){var a=n.value;Array.isArray(a)?o(e,a.flat()):(a=c(a))&&e.appendChild(a)}}catch(e){r.e(e)}finally{r.f()}}function c(e){if("function"==typeof e)return c(e());if(e instanceof Promise){var t=document.createTextNode("");e.then((function(e){if(Array.isArray(e))return(e=e.flat()).forEach((function(e){(e=c(e))&&t.before(e)})),void t.remove();(e=c(e))?t.replaceWith(e):t.remove()})),e=t}else if(e instanceof Text)"clone"in e&&(e=e.clone());else if(!(e instanceof Node)){var n=r(e);if(!["number","bigint","string"].includes(n))return null;if("string"===n&&!e)return null;e=a.text("".concat(e))}return e}return e.d(t,{default:function(){return a}}),window&&!window.tag&&(window.tag=a),Object.defineProperties(a,{get:{value:function(e){return document.querySelector(e)}},getAll:{value:function(e){return function(e){if(Array.isArray(e))return n(e)}(t=document.querySelectorAll(e))||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}();var t}},text:{value:function(e){return document.createTextNode(e)}},use:{value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=document.createTextNode(e);return t.clones=[t],t.shouldClone=!1,t._value=e,Object.defineProperty(t,"value",{set:function(e){t._value=e,t.clones.forEach((function(t){t.textContent=e})),"function"==typeof t.onChange&&t.onChange.call(t,e)},get:function(){return t._value}}),Object.defineProperty(t,"toString",{value:function(){return t._value}}),Object.defineProperty(t,"clone",{value:function(){if(!t.shouldClone)return t.shouldClone=!0,t;var e=t.cloneNode();return t.clones.push(e),e}}),t}}}),t.default}()}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var a=t[r]={exports:{}};return e[r].call(a.exports,a,a.exports,n),a.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";var e=n(958),t=n.n(e);!function(){let e="acode.coderunner.plugin",n=acode.require("url"),r=acode.require("fsoperation"),i=acode.require("helpers"),a=acode.require("settings"),o=acode.require("EditorFile"),c=acode.require("openFolder"),s=acode.require("multiPrompt");function l(e){return e.startsWith("content://com.termux.documents/tree")?(e=e.split("::")[1]).replace(/^\/data\/data\/com\.termux\/files\/home/,"$HOME"):e.startsWith("file:///storage/emulated/0/")?"/sdcard"+e.substr(26).replace(/\.[^/.]+$/,"").split("/").join("/")+"/":!!e.startsWith("content://com.android.externalstorage.documents/tree/primary")&&"/sdcard/"+e.split("::primary:")[1]}function u(e){return c.find(e.uri)}function d(e,t){return e.isTerminalOpened()||e.newTerminal?.()||e.openTerminal?.(),e.isMinimized()&&e.maximiseTerminal(),e.execute(t)}async function m(e,t){let n=await e.newTerminal({backend:"termux"});return this.$runBtn.replaceWith(this.$stopBtn),this.$stopBtn.onclick=()=>{n.backend.close()},n.backend.onclose=()=>{this.$stopBtn.replaceWith(this.$runBtn)},e.show?.(),n.execute(t)}class f{#e=null;#t;#n;#r=[{name:"Built In Runner",icon:"play_arrow",project:!0,match:e=>e.canRun(),handler:(e,t)=>{let{contextMenu:n}=t;return n?e.runFile():e.run()}}];async init(i,a,c,s){let d,m=this;this.#n=n.join(PLUGIN_DIR,e,"commands.json"),await r(this.#n).exists()||(await r(n.dirname(this.#n)).createFile("commands.json"),(d=this.settings.commands)?await r(this.#n).writeFile(JSON.stringify(d),"utf-8"):await r(this.#n).writeFile(await r(PLUGIN_DIR,e,"default_commands.json").readFile("utf-8"),"utf-8")),this.#t=JSON.parse(await r(this.#n).readFile("utf-8")||"[]"),this.#r.push({name:"NPM",icon:"file file_type_javascript",project:!0,async match(e){if("package.json"==e.name)return!0;let t=u(e);if(!t)return!1;let i=await r(n.join(t.url,"package.json"));return await i.exists()},async handler(e,t){let r,i,{execute:a}=t,o=[["installScript","install"]];if("package.json"==e.name)i=JSON.parse(e.session.getValue()||"{}");else{let t=u(e),r=await acode.fsOperation(n.join(t.url,"package.json"));if(!await r.exists())return;i=JSON.parse(await r.readFile("utf-8"))}for(let e in i.scripts||{})o.push([e,e]);if(r=o.length>0?await acode.select("Select script",o):await acode.prompt("Script name","start"),r)return"installScript"==r?await a(await m.#i("npm install",e,!1)):await a(await m.#i(`npm run ${r}`,e,!1))}}),this.#r.push({name:"Edit commands.json",icon:"file file_type_json",match:e=>!0,handler:()=>{new o(n.basename(this.#n),{uri:this.#n})},project:!0}),this.#r.push({name:"Django",icon:"file file_type_python",project:!0,async match(e){let t=u(e);if(!t)return!1;let r=await acode.fsOperation(n.join(t.url,"manage.py"));return await r.exists()},async handler(e,t){let{execute:n}=t,r=l(u(e).url),i=await acode.select("Select Django Command",[["runserver","Run Server","play_arrow"],["migrate","Migrate"],["makemigrations","Make Migrations"],["shell","Shell"],["other","Enter Command","edit"]]);if(i)return"other"==i&&(i=await acode.prompt("Enter command")),await n(await m.#i(`cd "${r}"; python manage.py ${i}`,e,!1))}}),app.get("#coderunner-run")?.remove(),app.get("#coderunner-stop")?.remove(),this.$runBtn=t()("span",{className:"icon play_circle_filled",id:"coderunner-run",attr:{action:"run"},title:"Run using code runner",onclick:this.run.bind(this),oncontextmenu:e=>{this.run(e,!0)}}),this.$stopBtn=t()("span",{className:"icon pause_circle_filled",id:"coderunner-stop",attr:{action:"run"},title:"Stop running.",onclick:this.stop.bind(this)}),this.$func=this.checkRunnable.bind(this),this.checkRunnable(),editorManager.on("switch-file",this.$func),editorManager.on("rename-file",this.$func),editorManager.editor.commands.addCommand({name:"code.runner:run",description:"Run Code",bindKey:{win:"Ctrl-R"},exec:()=>this.run(!1)}),editorManager.editor.commands.addCommand({name:"code.runner:run_file",description:"Run File",bindKey:{win:"Ctrl-Shift-R"},exec:()=>this.run(!0)}),acode.define("code.runner",{run:this.run.bind(this),stop:this.stop.bind(this),getDirectoryForFile:u,addHandler:this.addHandler.bind(this),removeHandler:this.removeHandler.bind(this)})}get logger(){if(this.#e)return this.#e;let e=acode.require("acode.sdk.logger");return e?(this.#e=e("acode.coderunner.plugin"),this.#e):null}get commands(){let e=this.settings.commands||this.#t;if("string"==typeof e)try{e=JSON.parse(e)}catch(e){throw acode.alert("Invalid command config"),e}return this.settings.projectsRunnable?[...e,...this.#r]:[...e,this.#r[0]]}async getHandler(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.getFileExtension(e.name),r=[];for(let i of this.commands)if(i.extension&&i.extension==n){if(t)return i;r.push(i)}else if(i.match){if("function"==typeof i.match&&await i.match(e)){if(t)return i;r.push(i)}if(new RegExp(i.match).exec(e.name)){if(t)return i;r.push(i)}}return r}ensureCd(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"$dir";return this.settings.changeDirectory?e:`cd "${t}"; ${e}`}async run(e,t){this.runCode(t)}async runCode(e){const t=editorManager.activeFile;let n,a,o,c=await this.getHandler(t,!1),s=async e=>{if(e){this.logger&&this.logger.debug("Running: "+e);try{await this.execute(e),this.logger&&this.logger.debug("Done. Exited with code=0")}catch(e){throw this.logger&&this.logger.error(`Failed to run "${t.name}" : ${String(e)}`),e}}};if(!e&&(o=c.find((e=>e.default))))n=o;else if(c.length>1||1==c.length&&c[0].project){c.push({name:"Configure Default",icon:"settings",project:!0,handler:async()=>{let e=c.filter((e=>!e.project));e.push({name:"Remove Default",icon:"settings"});let t=await acode.select("Select Default",e.map(((e,t)=>{let n=e.extension?i.getIconForFile("file."+e.extension):"play_arrow";return[e,(e.name||e.extension)+(e.default?" (Default)":""),e.icon?e.icon:n]})));t&&(e.map((e=>{e.default&&(e.default=!1)})),t.default=!0,await r(this.#n).writeFile(JSON.stringify(this.#t),"utf-8"))}});let e=await acode.select("Run Using",c.map(((e,t)=>{let n=e.extension?i.getIconForFile("file."+e.extension):"play_arrow";return[t,(e.name||e.extension)+(e.default?" (Default)":""),e.icon?e.icon:n]})));if(void 0===e)return;n=c[e]}else{if(1!=c.length)return;n=c[0]}(a=n.command)?(a=this.settings.commandEdit?await this.#i(a,t):this.formatCommand(a,t),a&&await s(a)):n.handler&&await n.handler(t,{contextMenu:e,execute:s})}async#i(e,t,n){let r=this;function i(){let e=app.get("#sourceCmd"),n=e.value;if(n){n=n.trim();let i=app.get("#handler"),a=app.get("#changeDir")?.checked;if(a){if(n.startsWith('cd "$dir"; '))return;i.setAttribute("value",i.value=r.formatCommand('cd "$dir"; '+n,t))}else i.setAttribute("value",i.value=r.formatCommand(e.value=n.replace('cd "$dir"; ',""),t))}}return(n=void 0!==n?n:this.settings.changeDirectory)&&(e='cd "$dir"; '+e),(await s("Run Code",[{id:"sourceCmd",value:e,onchange:i},{id:"handler",placeholder:"Handler",value:this.formatCommand(e,t)},[{id:"changeDir",type:"checkbox",placeholder:"Change Directory",onchange:i,value:n}]])).handler}stop(){this.$stopBtn.remove(),this.execute("^C"),this.logger&&this.logger.debug("Done. Exited with code=1")}async execute(e){let t,n=acode.require("acodex");if(console.log(n,acode.require("acode.terminal"),this.settings.runLibrary),"AcodeX"==this.settings.runLibrary&&n)await d(n,e);else if(t=acode.require("acode.terminal")){if("AcodeX"==this.settings.runAcodeTerminal){let e="AcodeX unavailable falling back to Acode Terminal.";this.logger&&this.logger.debug(e),console.info(e)}await m.bind(this)(t,e)}else{if(!n){let e="AcodeX or Acode Terminal plugin required to use Coderunner.\n Please install first.";return this.logger&&this.logger.error(e),acode.alert("Coderunner Error",e),!1}{let t="AcodeX available falling back to AcodeX.";this.logger&&this.logger.debug(t),console.info(t),await d(n,e)}}}destroy(){this.$runBtn&&(this.$runBtn.onclick=null,this.$runBtn.remove(),this.$stopBtn.remove()),editorManager.off("switch-file",this.$func),editorManager.off("rename-file",this.$func),editorManager.editor.commands.removeCommand("code.runner:run_code")}async checkRunnable(){const e=editorManager.activeFile;this.$runBtn.isConnected?this.$runBtn.remove():this.$stopBtn.isConnected&&this.$stopBtn.remove(),this.checkFileRunnable(e)}async checkFileRunnable(e){let t=await this.getHandler(e),n=this.$runBtn;if(t){const e=root.get("header");if(this.settings.replaceRunBtn){let t;t=setInterval((()=>{let r=e.get('.icon.play_arrow[action="run"]');r&&(r.remove(),clearInterval(t),e.insertBefore(n,e.lastChild))}),10)}e.insertBefore(n,e.lastChild)}else n.remove()}async checkProjectRunnable(e){}getFileExtension(e){return String(e).split(".").at(-1)}formatCommand(e,t,n){if(e){let n=t.name.split(".");n.pop();let r=n.join("."),i=l(t.uri),a=i.split("/");a.pop();let o=a.join("/")+"/",c=u(t);return e.replaceAll("$nameNoExt",r).replaceAll("$dirNoSlash",o.slice(0,o.length-1)).replaceAll("$workspaceUrl",c?.url).replaceAll("$workspace",c?.url.split("::")[1]).replaceAll("$name",t.name).replaceAll("$dir",o).replaceAll("$uri",i)}}addHandler(e){this.#r.push(e)}removeHandler(e){this.#r=this.#r.filter((t=>t.name===e))}initialSettings(){return{changeDirectory:!0,replaceRunBtn:!0,projectsRunnable:!0,commandEdit:!0,runLibrary:"AcodeX"}}remakeOldsettings(){let e=this.settings.commands;if(e&&Array.isArray(e[0])){let t=[];e.forEach((e=>{t.push({extension:e[0],command:e[1],name:this.#t.find((t=>{t.extension,e[0]}))?.name||e[0]})})),this.#t=t}}format(e){const{beautify:t}=ace.require("ace/ext/beautify");let n=JSON.stringify(e),r=ace.createEditSession("");return r.setValue(n),r.setMode("json"),t(r),r.getValue()}get settingsObj(){let e=this.settings;return e.commands||this.#t,{list:[{index:0,key:"changeDirectory",text:"Change Directory",info:"Change the current directory before running.",checkbox:e.changeDirectory},{index:1,key:"runLibrary",text:"Terminal Library",value:"AcodeX",info:"Acode library to use to execute commands.",select:["AcodeX","Acode Terminal"]},{index:3,key:"replaceRunBtn",text:"Replace Run Button",info:"Replace the default run button",checkbox:e.replaceRunBtn},{index:4,key:"projectsRunnable",text:"Run Projects",info:"Display option to run projects.",checkbox:e.projectsRunnable},{index:5,key:"commandEdit",text:"Enable Command Edit Box",info:"Whether to display prompt to edit command before running.",checkbox:e.commandEdit}],cb:(e,t)=>{this.settings[e]=t,a.update()}}}get settings(){let e=a.value["acode.coderunner.plugin"];return e||(e=a.value["acode.coderunner.plugin"]=this.initialSettings(),a.update()),e}}if(window.acode){const t=new f;acode.setPluginInit(e,(async(e,n,r)=>{let{cacheFileUrl:i,cacheFile:a,firstInit:o}=r;e.endsWith("/")||(e+="/"),t.baseUrl=e;try{await t.init(n,a,i,o),document.dispatchEvent(new CustomEvent("plugin.install",{detail:{name:"coderunner",plugin:t}}))}catch(e){console.log(e),alert(String(e))}}),t.settingsObj),acode.setPluginUnmount(e,(()=>{t.destroy()}))}}()})()})();